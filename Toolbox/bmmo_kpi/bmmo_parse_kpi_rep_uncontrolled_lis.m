function kpi_uncontrolled = bmmo_parse_kpi_rep_uncontrolled_lis(kpi_rep_uncontrolled, stats_rep_uncontrolled)
%
% function kpi_input = bmmo_parse_kpi_rep_uncontrolled_lis(kpi_rep_uncontrolled, stats_rep_uncontrolled)
%
%Given the Uncontrolled input KPIs from the OTAS job report, parse the
%contents into a BMMO-NXE kpi structure
% Input:
%   kpi_rep_uncontrolled  : Uncontrolled input KPIs from the job report
%   stats_rep_uncontrolled : Uncontrolled input PIs from the job report
%
% Output:
%   kpi_input :  KPI Uncontrolled overlay structure as generated by
%   BMMO model
%
% Changelog
% 20201030 LUDU Creation (adapted from bmmo_parse_kpi_rep_uncontrolled)

% Uncontrolled overlay kpis
kpi_uncontrolled.overlay = bmmo_parse_kpi_overlay_lis(stats_rep_uncontrolled(1).OverlayMetrics, stats_rep_uncontrolled(2).OverlayMetrics, 'kpi2');
kpi1_uncontrolled.overlay = bmmo_parse_kpi_overlay_lis(kpi_rep_uncontrolled(1).OverlayMetrics, kpi_rep_uncontrolled(2).OverlayMetrics, 'kpi');
kpi_uncontrolled.overlay = bmmo_add_missing_fields(kpi_uncontrolled.overlay, kpi1_uncontrolled.overlay);

% ERO PIs
if isfield(stats_rep_uncontrolled(1), 'Clamp')
    kpi_uncontrolled.input_clamp = bmmo_parse_clamp_pi_lis(stats_rep_uncontrolled(1).Clamp, stats_rep_uncontrolled(2).Clamp, 'uncontrolled');
end

% Uncontrolled Intrafield metrics, ripple and k-factors 
kpi_uncontrolled.intrafield = bmmo_parse_kpi_overlay_lis(stats_rep_uncontrolled(1).IntrafieldMetrics, stats_rep_uncontrolled(2).IntrafieldMetrics, 'all');
kpi_uncontrolled.intrafield.ovl_ripple_3s_chk1 = str2double(stats_rep_uncontrolled(1).IntrafieldMetrics.IntrafieldAveragedColumn.StDev3.Y) * 1e-9;
kpi_uncontrolled.intrafield.ovl_ripple_3s_chk2 = str2double(stats_rep_uncontrolled(2).IntrafieldMetrics.IntrafieldAveragedColumn.StDev3.Y) * 1e-9;

kpi_uncontrolled.intrafield = bmmo_parse_kpi_ho_rep_lis(kpi_uncontrolled.intrafield, stats_rep_uncontrolled(1).KFactors, stats_rep_uncontrolled(2).KFactors);
