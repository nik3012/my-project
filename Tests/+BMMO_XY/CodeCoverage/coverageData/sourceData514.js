var sourceData514 = {"FileContents":["function [sbc2, inline_sdm] = bmmo_kt_process_SBC2rep(filename)\r","% function [sbc2, inline_sdm] = bmmo_kt_process_SBC2rep(filename)\r","% <help_update_needed>\r","\r","% function [sbc2, inline_sdm] = bmmo_kt_process_SBC2rep(filename)\r","%\r","% Read an ADELsbcDriftControlNxeRep.xml (Protected/Unprotected) file and \r","% format the sbc output like the output of bmmo_nxe_drift_control_model.\r","%\r","% Input:\r","% - filename: name of the .xml file containing the sbc report\r","%\r","% Output:\r","% - sbc2: formatted correction set\r","% - inline_sdm: Inline SDM output with following fields:\r","%     sdm_res: Inline SDM residuals\r","%     sdm_cet_res: Intrafield system CET residual (only if present)\r","%     sdm_model: SDM model type: Baseliner 3/ BMMO NXE \r","%     sdm_kpi: Inline SDM KPIs\r","\r","MAX_CHUCK_NR = 2;\r","\r","if ischar(filename)\r","    xml = bmmo_load_ADEL(filename);\r","else\r","    xml = filename;\r","end\r","\r","sbc2 = [];\r","tmp = bmmo_default_output_structure(bmmo_default_options_structure);\r","sdm_res = tmp.corr;\r","sdm_cet_res = tmp.corr;\r","\r","for ic = 1:MAX_CHUCK_NR\r","    mask = arrayfun(@(x) endsWith(x.elt.MatchedInfoList.elt.CorrSetList.elt.CorrSetName, num2str(ic)), xml.AppliedCorrectionList);\r","    ind(ic) = find(mask, 1);\r","    waferstagechuckid = xml.AppliedCorrectionList(ind(ic)).elt.MatchedInfoList.elt.CorrSetList.elt.CorrSetName;\r","    chuck_id = str2double(waferstagechuckid(end));\r","    \r","    this_set = xml.AppliedCorrectionList(ind(ic)).elt.Corrections;\r","    \r","    sbc2 = bmmo_kt_process_sbc_correction(sbc2, this_set, chuck_id);\r","    \r","    this_set.SdmDistortionMap = xml.AppliedCorrectionResults.SdmDistortionResiduals(ind(ic)).elt;\r","    \r","    sdm_res = bmmo_kt_process_sbc_correction(sdm_res, this_set, chuck_id);\r","    inline_sdm.sdm_res = sdm_res.ffp;\r","    \r","    if isfield(xml.AppliedCorrectionResults, 'SdmIntrafieldSystemCetResidual')\r","        this_set.SdmDistortionMap = xml.AppliedCorrectionResults.SdmIntrafieldSystemCetResidual(ind(ic)).elt;\r","        sdm_cet_res = bmmo_kt_process_sbc_correction(sdm_cet_res, this_set, chuck_id);\r","        inline_sdm.sdm_cet_res = sdm_cet_res.ffp;\r","        \r","        if isfield(xml.AppliedCorrectionResults.SdmIntrafieldSystemCetResidual(1).elt.Header, 'AppliedFilter')\r","            inline_sdm.sdm_filter  = xml.AppliedCorrectionResults.SdmIntrafieldSystemCetResidual(1).elt.Header.AppliedFilter;\r","        end\r","    end\r","end\r","xml_corr_IFO = xml.AppliedCorrectionList;\r","corr_names = arrayfun(@(x) x.elt.MatchedInfoList.elt.CorrSetList.elt.CorrSetName, xml_corr_IFO, 'UniformOutput', false);\r","[~, idx_unique] = unique(string(corr_names), 'stable');\r","corr_names = corr_names(idx_unique);\r","IFO_id = idx_unique > max(ind);\r","[~, I] = sort(corr_names(IFO_id));\r","xml_corr_IFO = xml_corr_IFO(IFO_id);\r","xml_corr_IFO = xml_corr_IFO(I);\r","xml_corr_IFO = arrayfun(@(x) x.elt.Corrections.IntraFieldOffset, xml_corr_IFO);\r","sbc2 = bmmo_parse_sbc_IFO(sbc2, xml_corr_IFO);\r","sbc2 = bmmo_add_missing_corr(sbc2);\r","\r","if ~all(sbc2.IR2EUV == sbc2.IR2EUV(1))\r","    warning('Different IR/EUV ratios found for different correction sets. Using the first value found.');\r","end\r","sbc2.IR2EUV = sbc2.IR2EUV(1);\r","\r","if isfield(xml.AppliedCorrectionList(1).elt.Corrections.SdmDistortionMap.Header, 'SdmModel')\r","    inline_sdm.sdm_model  = xml.AppliedCorrectionList(1).elt.Corrections.SdmDistortionMap.Header.SdmModel;\r","end\r","\r","if isfield(xml.AppliedCorrectionList(1).elt.Corrections.SdmDistortionMap.Header,'TimeFilter')\r","    inline_sdm.time_filter = str2double(xml.AppliedCorrectionList(1).elt.Corrections.SdmDistortionMap.Header.TimeFilter);\r","else\r","    inline_sdm.time_filter = 1;\r","end\r","\r","kpi_struct = bmmo_parse_kpi_ADELsbcrep_inlineSDM(xml);\r","inline_sdm.sdm_kpi =  kpi_struct.applied.InlineSDM;\r",""],"CoverageData":{"CoveredLineNumbers":[21,23,24,29,30,31,32,34,35,36,37,38,40,42,44,46,47,49,50,51,52,54,55,59,60,61,62,63,64,65,66,67,68,69,71,74,76,77,80,81,82,83,86,87],"UnhitLineNumbers":[25,26,72],"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,0,6,6,0,0,0,0,6,6,6,6,0,6,12,12,12,12,0,12,0,12,0,12,0,12,12,0,12,2,2,2,0,2,2,0,0,0,6,6,6,6,6,6,6,6,6,6,6,0,6,0,0,6,0,6,1,0,0,6,2,4,4,0,0,6,6,0]}}