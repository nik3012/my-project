var sourceData47 = {"FileContents":["function [ml_system_nce] = bmmo_calculate_system_nce(inline_sdm_residual, options)\r","%function [ml_system_nce] = bmmo_calculate_system_nce(inline_sdm_residual, options) \r","%\r","% Calculates the system nce from the inline sdm residual\r","%\r","% input: \r","%   inline_sdm_residual: 1x2 inline sdm residual from input_struct\r","%   options :            options structure\r","%   \r","% output: \r","%   system_nce:         system_nce in ml struct interpolated to RINT\r","\r","system_nce = inline_sdm_residual;\r","\r","[~, ~, index_out] = bmmo_fix_nd_grid(inline_sdm_residual(1).x, inline_sdm_residual(1).y);\r","\r","%average of two chucks\r","[~, dim] = min(size(inline_sdm_residual(1).dx));\r","dx_mean = mean([inline_sdm_residual(1).dx, inline_sdm_residual(2).dx], dim);\r","dy_mean = mean([inline_sdm_residual(1).dy, inline_sdm_residual(2).dy], dim);\r","\r","% rearrange to ndgrid format \r","dxg_mean = dx_mean(index_out);\r","dyg_mean = dy_mean(index_out);\r","\r","for ic = 1:length(inline_sdm_residual)\r","    dxg = inline_sdm_residual(ic).dx(index_out);\r","    dyg = inline_sdm_residual(ic).dy(index_out);\r","    % system nce = total nce - lens nce, where lens nce is the average\r","    % column\r","    system_nce(ic).dx = reshape(dxg - mean(dxg_mean, 2), [], 1);\r","    system_nce(ic).dy = reshape(dyg - mean(dyg_mean, 2), [], 1);\r","    system_nce(ic).dx = system_nce(ic).dx(index_out(:));\r","    system_nce(ic).dy = system_nce(ic).dy(index_out(:));\r","end\r","\r","ml_system_nce_in = bmmo_ffp_to_ml_simple(system_nce); % FFP to ml\r","\r","% Intrafield NCE interpolation to RINT per chuck\r","for ic = 1: ml_system_nce_in.nwafer\r","    ml_system_nce(ic)   = bmmo_correct_intrafield_shift(ovl_get_wafers(ml_system_nce_in, ic), options);\r","end \r","\r",""],"CoverageData":{"CoveredLineNumbers":[13,15,18,19,20,23,24,26,27,28,31,32,33,34,37,40,41],"UnhitLineNumbers":[],"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,8,0,8,0,0,8,8,8,0,0,8,8,0,8,16,16,0,0,16,16,16,16,0,0,8,0,0,8,16,0,0,0]}}