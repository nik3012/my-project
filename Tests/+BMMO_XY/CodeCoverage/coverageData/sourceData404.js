var sourceData404 = {"FileContents":["function [mlo, expinfo, xshift, yshift, layer_fields] = bmmo_collapse_layers(mli, expinfo)\r","% function [mlo, expinfo, xshift, yshift] = bmmo_collapse_layers(mli, expinfo)\r","%\r","% Convert n-field 2-layer structure to single-layer structure with 2n\r","% fields, with a field centre shift for the second layer. Optionally\r","% provide exposure info with field order; otherwise a default field order\r","% will be used.\r","%\r","% Input:\r","%   mli: overlay structure with 2 layers\r","%\r","% Optional Input:\r","%   expinfo: structure with fields\r","%       xc: 2n * 1 double vector of x field centre coordinates\r","%       yc: 2n * 1 double vector of y field centre coordinates\r","%\r","% Output:\r","%   mlo: overlay structure with 1 layer\r","%   expinfo: cf optional input\r","%   xshift: x field centre shift to layer 2 (double)\r","%   yshift: y field centre shift to layer 2 (double)\r","%   layer_fields: cell array with field IDs per layer\r","%\r","% 20170519 SBPR Creation\r","\r","mlo = ovl_get_layers(mli, 1);\r","layer_fields{1} = 1:mlo.nfield;\r","\r","if nargin < 2\r","    % initialize a default shift\r","    xshift = 0.52e-3;\r","    yshift = -0.52e-3;\r","    % generate a default expinfo with n layers\r","    expinfo = bmmo_get_default_expinfo(mlo);\r","    for il = 2:mli.nlayer\r","       newxc = expinfo.xc(1:mli.nfield) + (xshift * (il-1));\r","       newyc = expinfo.yc(1:mli.nfield) + (yshift * (il-1));\r","       newv = v(1:mli.nfield);\r","       expinfo.xc = [expinfo.xc ; newxc];\r","       expinfo.yc = [expinfo.yc ; newyc];\r","       expinfo.v = [expinfo.v ; newv];\r","    end\r","else\r","    %determine xshift and yshift from expinfo\r","    [xshift, yshift] = bmmo_get_shifts_from_expinfo(mli, expinfo);\r","end\r","\r","shift_mag = sqrt(xshift^2 + yshift^2) + 1e-3;\r","tmpxc = reshape(expinfo.xc, [], mli.nlayer);\r","tmpyc = reshape(expinfo.yc, [], mli.nlayer);\r","\r","for il = 2:mli.nlayer\r","   ml_il = ovl_get_layers(mli, il);\r","   \r","   % generate a template layout with same field ordering as in expinfo\r","   xc = tmpxc(:, il);\r","   yc = tmpyc(:, il);\r","   \r","   mlt = bmmo_construct_layout(xc, yc, ml_il, 1, ml_il.nwafer);\r","   \r","   mlmap = bmmo_map_shifted_layouts(ml_il, mlt, shift_mag);\r","   \r","   mlo = ovl_combine_fields(mlo, mlmap);\r","   layer_fields{il} = ((mli.nfield * (il-1)) + 1):(mli.nfield * il);\r","end\r","\r","\r",""],"CoverageData":{"CoveredLineNumbers":[],"UnhitLineNumbers":[26,27,29,31,32,34,35,36,37,38,39,40,41,43,45,48,49,50,52,53,56,57,59,61,63,64],"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}