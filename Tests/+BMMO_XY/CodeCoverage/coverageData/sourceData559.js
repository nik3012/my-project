var sourceData559 = {"FileContents":["function mlo = bmmo_get_meas_data_bmmo(wafers_out, expinfo, phase)\r","% function mlo = bmmo_get_meas_data(wafers_out, expinfo, phase)\r","%\r","% Get an ml structure (array) from KT_wafers_out, based on a template\r","% constructed from expinfo\r","%\r","% Input: wafers_out: full path to a KT_wafers_out file\r","%        expinfo: structure containing xc and yc vectors\r","%\r","% Output: mlo: ml structure array\r","%\r","% 20160331 SBPR Creation\r","\r","if nargin < 3\r","    phase = 1;\r","end\r","\r","% constants for bmmo_KT_2_ml\r","USE_LAYOUT = 1;\r","\r","if phase == 1\r","    X_SHIFT = 0.8405e-3;\r","    Y_SHIFT = -0.8695e-3;\r","\r","    X_SHIFT_L2 = 0.9605e-3;\r","    Y_SHIFT_L2 = -0.1895e-3;\r","\r","else\r","    X_SHIFT = 0;\r","    Y_SHIFT = 0;\r","\r","    X_SHIFT_L2 = 0;\r","    Y_SHIFT_L2 = 0;\r","end\r","\r","XF_SHIFT = [0 -260e-6];\r","YF_SHIFT = [0 -40e-6];\r","\r","% construct a template full-field ml structure based on the input\r","ml_exp = bmmo_kt_ml_from_expinfo(expinfo);\r","\r","% apply inverted shifts and recombine\r","ml_main = ovl_get_fields(ml_exp, 1:87);\r","ml_edge = ovl_get_fields(ml_exp, 88:ml_exp.nfield);\r","\r","ml_main = bmmo_shift_fields(ml_main, -X_SHIFT, -Y_SHIFT);\r","ml_edge = bmmo_shift_fields(ml_edge, -X_SHIFT_L2, -Y_SHIFT_L2);\r","\r","ml_exp = ovl_combine_fields(ml_main, ml_edge);\r","\r","% map wafers_out to this structure\r","mlo = bmmo_KT_2_ml(wafers_out, USE_LAYOUT, ml_exp, 'BMMO', 'XPA');\r","\r","% apply shifts to output and recombine\r","ml_main = ovl_get_fields(mlo, 1:87);\r","ml_edge = ovl_get_fields(mlo, 88:ml_exp.nfield);\r","\r","ml_main = bmmo_shift_fields(ml_main, X_SHIFT, Y_SHIFT);\r","ml_edge = bmmo_shift_fields(ml_edge, X_SHIFT_L2, Y_SHIFT_L2);\r","\r","mlo = ovl_combine_fields(ml_main, ml_edge);\r","\r","% apply ys readout shift \r","mlo = bmmo_shift_fields(mlo, XF_SHIFT, YF_SHIFT);\r","\r","disp('ensuring field centres from ADELler are found in reconstructed ml');\r","xc_yc = [mlo.wd.xc, mlo.wd.yc];\r","u_xc_yc = unique(xc_yc, 'rows');\r","e_xc_yc = [expinfo(1).xc expinfo(1).yc];\r","[~, sortorder] = sort(e_xc_yc(:,2));\r","e_xc_yc = e_xc_yc(sortorder, :);\r","[~, sortorder] = sort(e_xc_yc(:,1));\r","e_xc_yc = e_xc_yc(sortorder, :);\r","\r","assert(max(max(abs(u_xc_yc - e_xc_yc))) < 1e-12);\r","\r","% Verify mark positions after YS readout field shifts\r","mls = bmmo_shift_fields(mlo, -XF_SHIFT, -YF_SHIFT);\r","xw_yw = [mls.wd.xw, mls.wd.yw];\r","\r","[~,D] = knnsearch(xw_yw, e_xc_yc);\r","assert(max(abs(D)) < 1e-12);\r","\r","disp('verifying all fields have measurement data');\r","for iw = 1:mlo.nwafer\r","   for ifield = 1:mlo.nfield\r","        ml_field = ovl_get_fields(ovl_get_wafers(mlo, iw),ifield);\r","        if(all(isnan(ml_field.layer.wr.dx)) | all(isnan(ml_field.layer.wr.dy)))\r","            error('field %d of wafer %d is all NaN', ifield, iw);\r","        end\r","   end\r","end\r",""],"CoverageData":{"CoveredLineNumbers":[],"UnhitLineNumbers":[14,15,19,21,22,23,25,26,28,29,30,32,33,36,37,40,43,44,46,47,49,52,55,56,58,59,61,64,66,67,68,69,70,71,72,73,75,78,79,81,82,84,85,86,87,88,89],"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}