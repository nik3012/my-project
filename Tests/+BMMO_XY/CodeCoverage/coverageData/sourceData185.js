var sourceData185 = {"FileContents":["function results_out = bmmo_sub_model_SUSD_2L_monitor(results_in, options)\r","% function results_out = bmmo_sub_model_SUSD_2L_monitor(results_in, options)\r","%\r","% The  SUSD sub-model, used for two layer input and monitoring only\r","%\r","% Input:\r","%   results_in: structure containing various results from other models\r","%   options: options structure\r","%\r","% Output:\r","%   results_out: structure containing intermediate models and results\r","%       This function adds the field SUSD, with the following subfields:\r","%           model: SUSD model\r","%           Calib_SUSD: SUSD calibrations\r","%           fp: (only if not already in WH combined model) SUSD fingerprint\r","%\r","%       If it does not exist, it also adds the field WH with the subfields\r","%       ml7x7 and FPS. (see bmmo_sub_model_WH for definitions).\r","\r","results_out = results_in;\r","model = 'WH_SUSD';\r","\r","% Switch WH fp for modelling into options\r","options.WH.input_fp_per_chuck = results_in.WH.model_fp;\r","\r","[results_out.SUSD.ml_7x7, results_out.SUSD.FPS, C] = bmmo_setup_combined_model(results_in.WH.input, options, model);\r","\r","% Remove edge fields\r","for ic = options.chuck_usage.chuck_id_used\r","    [~, edge_fieldnos] = ovl_get_innerfields(results_out.SUSD.ml_7x7(ic), 'radius', options.edge_clearance, 'marks', 'invert');\r","    results_out.SUSD.ml_7x7(ic) = ovl_combine_linear(results_out.SUSD.ml_7x7(ic), 1, ovl_combine_linear(ovl_get_fields(results_out.SUSD.ml_7x7(ic), edge_fieldnos), NaN));\r","end\r","\r","% SUSD sub-model (2-layer SUSD control calibrated in WH_SUSD submodel)\r","% Run the combined model\r","[fit_coeffs, fitted_fps] = bmmo_combined_model(results_out.SUSD.ml_7x7, results_out.SUSD.FPS, options, C);\r","\r","% gather the SUSD output   \r","for chuck_id = options.chuck_usage.chuck_id_used\r","    results_out.SUSD.Monitor_SUSD(chuck_id) = fit_coeffs.SUSD{chuck_id}*1/options.scaling_factor;\r","    results_out.SUSD.fitted_fp(chuck_id) = fitted_fps.SUSD(chuck_id);\r","end\r","\r","% mail from ZHMA 20160824:\r","% as we model SUSD using delta of 2 layers, the final SUSD value e.g.\r","% Ty should be half of the fitted Ty from combined model.\r","% -1 factor to get L1 Ty as we are using s2f in the 2 layer case\r","results_out.SUSD.Monitor_SUSD = -1*results_out.SUSD.Monitor_SUSD / 2;\r",""],"CoverageData":{"CoveredLineNumbers":[20,21,24,26,29,30,31,36,39,40,41,48],"UnhitLineNumbers":[],"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,78,78,0,0,78,0,78,0,0,78,150,150,0,0,0,0,78,0,0,78,150,150,0,0,0,0,0,0,78,0]}}