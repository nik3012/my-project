var sourceData137 = {"FileContents":["function kpi_out = bmmo_get_ripple_kpi(ml, options, kpi_in)\r","% function kpi_out = bmmo_get_ripple_kpi(ml, options, kpi_in)\r","% This function claculates the uncontrolled ripple KPIs as mentioned in \r","% D000810611 EDS BMMO NXE drift control model\r","%\r","% Input:\r","%  ml: controlled input with only Interfield correction (excludes previous\r","%   Intrafield SBC)\r","%  options: BMMO/BL3 option structure\r","%  kpi_in: KPI input structure to include the output of the function \r","%\r","% Output:\r","%  kpi_out: kpi_in with uncontrolled ripple KPIs\r","\r","kpi_out = kpi_in;\r","\r","for ic = 1:2\r","    chuckstr = num2str(ic);\r","    wid_this_chuck = find(options.chuck_usage.chuck_id == ic);\r","    if isempty(wid_this_chuck)\r","        kpi_out.(['ovl_ripple_3s_chk' chuckstr]) = 0;\r","    else\r","        wafers_this_chuck = ovl_average(ovl_get_wafers(ovl_model(ml,'10par','perwafer'),wid_this_chuck));\r","        field_this_chuck = ovl_average_fields(ovl_get_fields(wafers_this_chuck, options.fid_intrafield));\r","        avg_col = sub_ovl_average_column(field_this_chuck);\r","        \r","        ov_chuck = ovl_calc_overlay(avg_col);\r","        \r","        kpi_out.(['ovl_ripple_3s_chk' chuckstr]) = ov_chuck.oy3sd;\r","    end\r","end\r","\r","function mlo = sub_ovl_average_column(ml)\r","\r","for i = 1: ml.nwafer\r","    mli = ovl_get_wafers(ml,i);\r","    fld = ovl_average(mli);\r","    [xc,yc,xf,yf,dxi,dyi] = ovl_concat_wafer_results(fld);\r","    rowlist = sort_and_collect(yf,1e-4);\r","    for ii =1: length(rowlist)\r","        rowlist(ii).dxi = nanmean_r12(dxi(rowlist(ii).id));\r","        dxi(rowlist(ii).id) = nanmean_r12(dxi(rowlist(ii).id));\r","        rowlist(ii).dyi = nanmean_r12(dyi(rowlist(ii).id));\r","        dyi(rowlist(ii).id) = nanmean_r12(dyi(rowlist(ii).id));\r","    end\r","    if i == 1\r","        mlo = ovl_distribute_wafer_results(fld,dxi,dyi);\r","    else\r","        mlo = ovl_combine_wafers(mlo,ovl_distribute_wafer_results(fld,dxi,dyi));\r","    end\r","end"],"CoverageData":{"CoveredLineNumbers":[15,17,18,19,20,21,22,23,24,25,27,29,35,36,37,38,39,40,41,42,43,44,46,47],"UnhitLineNumbers":[48,49],"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,124,0,124,248,248,248,6,242,242,242,242,0,242,0,242,0,0,0,0,0,242,242,242,242,242,242,4598,4598,4598,4598,0,242,242,0,0,0,0]}}