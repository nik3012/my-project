var sourceData131 = {"FileContents":["function [mean_density, max_density_per_wafer, index_per_wafer]= bmmo_get_outlier_density(input_mli, model_results, options)\r","% function [mean_density, max_density_per_wafer, index_per_wafer] = bmmo_get_outlier_density(input_mli, model_results, options)\r","%\r","% Get the mean outlier density per wafer\r","% The outlier density of a wafer is the maximum ratio of outliers to marks \r","% in the marks within a given radius of each outlier in that wafer. See\r","% D000810611 for the definition.\r","%\r","% Input: \r","%  input_mli: raw input including invalidated marks from yieldstar\r","%  stat: computed outlier statistics\r","%\r","% Optional input:\r","%  options: default options structure\r","%   \r","% Output: \r","%  mean_density: the mean of the maximum outlier densities per wafer\r","      \r","if nargin < 3\r","    options = bmmo_default_options_structure;\r","end\r","\r","all_wafer_points = [input_mli.wd.xw input_mli.wd.yw];\r","\r","max_density_per_wafer = zeros(1, input_mli.nwafer);\r","index_per_wafer = zeros(1, input_mli.nwafer);\r","\r","stat = model_results.outlier_stats;\r","readout_nans = model_results.readout_nans;\r","\r","% only calculate for single-mark field input, otherwise the density value\r","% is incorrect\r","if input_mli.nmark == 1\r","    for iw = 1:input_mli.nwafer\r","\r","        outlier_points = [stat.layer.wafer(iw).x stat.layer.wafer(iw).y; readout_nans(iw).x readout_nans(iw).y];\r","\r","        if size(outlier_points, 1) > 500\r","            % Too many outliers: skip the density calculation and set\r","            % density to maximum\r","            max_density_per_wafer(iw) = 1;\r","        elseif size(outlier_points, 1) > 0\r","            % get distance matrices for neighbouring outliers and points\r","            d_mat_outliers = bmmo_pdist2(outlier_points, outlier_points);\r","            d_mat_marks = bmmo_pdist2(all_wafer_points, outlier_points);\r","                   \r","            % per outlier, get the marks and outliers in the neighbourhood\r","            outliers_in_neighbourhood = sum(double(d_mat_outliers < options.outlier_check_radius));\r","            marks_in_neighbourhood = sum(double(d_mat_marks < options.outlier_check_radius));\r","\r","            [max_density_per_wafer(iw), index_per_wafer(iw)] = max(outliers_in_neighbourhood ./ marks_in_neighbourhood);\r","            \r","        end\r","    end\r","end\r","\r","mean_density = mean(max_density_per_wafer);\r","\r",""],"CoverageData":{"CoveredLineNumbers":[19,23,25,26,28,29,33,34,36,38,41,42,44,45,48,49,51,57],"UnhitLineNumbers":20,"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,122,0,0,0,122,0,122,122,0,122,122,0,0,0,122,120,0,622,0,622,0,0,122,500,0,204,204,0,0,204,204,0,204,0,0,0,0,0,122,0,0]}}