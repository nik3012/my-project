var sourceData761 = {"FileContents":["function mlo = bmmo_recorrect(mli, new_corr, update_fn)\r","% function mlo = bmmo_recorrect(mli, new_corr, update_fn)\r","%\r","% Decorrect the correction in mli.info.previous_correction, apply the\r","% correction in new_corr, and then replace mli.info.previous_correction\r","% with new_corr\r","%\r","% Input:\r","%   mli: valid input for bmmo_nxe_drift_control_model\r","%   new_corr: SBC2 correction set as output by bmmo_nxe_drift_control_model\r","%\r","% optional input:\r","%   update_fn: handle to correction update function (e.g.\r","%   bmmo_update_corr_18par)\r","%   \r","% Output: \r","%   mlo: mli with mli.info.previous_correction decorrected, new_corr\r","%       applied, and mli.info.previous_correction replaced with new_corr\r","%\r","% 20160901 SBPR Creation\r","% 20191213 SELR Adapted for new version of bmmo_apply_SBC\r","% 20200710 JIMI Update the function for intrafield 5th order CET actuation\r","\r","if nargin < 3\r","    update_fn = @sub_empty_update;\r","end\r","\r","% decorrect mli.info.previous_correction\r","mli_new = bmmo_undo_corr_from_input(mli);\r","\r","% correct with new correction\r","if isfield(new_corr, 'Configurations')\r","    corr = rmfield(new_corr, 'Configurations');\r","else\r","    corr = new_corr;\r","end\r","\r","[corr_tmp, res] = feval(update_fn, corr);\r","\r","factor = 1;\r","skip_sdm = 1;\r","\r","fps = bmmo_apply_SBC_inline_SDM(mli, corr_tmp, factor, skip_sdm);\r","new_sbc = bmmo_map_to_smf(fps.TotalSBCcorrection, mli);\r","mlo = ovl_add(mli_new, new_sbc);\r","\r","mlo.info.previous_correction = corr;\r","mlo.info.report_data.inline_sdm_residual = res;\r","\r","if isfield(mli.info,'configuration_data') \r","   mlo.info.configuration_data = mli.info.configuration_data;\r","end\r","\r","function [corr_out, res] = sub_empty_update(corr)\r","\r","corr_out = corr;\r","\r","res = corr.ffp;\r","for ii = 1:2\r","   res(ii).dx = res(ii).dx * 0;\r","   res(ii).dy = res(ii).dy * 0;\r","end"],"CoverageData":{"CoveredLineNumbers":[],"UnhitLineNumbers":[24,25,29,32,33,34,35,38,40,41,43,44,45,47,48,50,51,56,58,59,60,61],"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}