var sourceData576 = {"FileContents":["function [ml_KA_cet_corr, ml_KA_cet_nce, xml_data, KA_actuation] = bmmo_read_adelwafergridresidual(adel_filepath, ml_cet)\r","%function [ml_KA_cet_corr, ml_KA_cet_nce, xml_data, KA_actuation] = bmmo_read_adelwafergridresidual(adel_filepath, ml_cet)\r","\r","% Given the file path for ADELwaferGridResidualReportProtected, the\r","% function decryptes and parses to output KA requested correction & KA CET NCE.\r","%\r","% Input\r","%   adel_filepath: ADELwaferGridResidualReportProtected path\r","%   ml_cet   : ful CET NCE in ml structure\r","% Output:\r","%   ml_KA_cet_corr: KA correction requested to CET in ml struct\r","%   ml_KA_cet_nce : KA CET NCE in ml struct\r","%   xml_data     : decrypted ADEL in xml_load format\r","%   KA_actuation  : Shows which type of actuation (higher/lower order).\r","\r","%load in the residual report\r","xml_data = bmmo_load_ADEL(adel_filepath);\r","   \r","ROUNDING_SF = 12;\r","%\r","% build xc, yc\r","xc = str2double(arrayfun(@(x) (x.elt.FieldPosition.X), xml_data.Results.WaferResultList(1).elt.ImageResultList(1).elt.ExposureResultList, 'UniformOutput', false)) * 1e-3;\r","yc = str2double(arrayfun(@(x) (x.elt.FieldPosition.Y), xml_data.Results.WaferResultList(1).elt.ImageResultList(1).elt.ExposureResultList, 'UniformOutput', false)) * 1e-3;\r","\r","full_grid_size = numel(xml_data.Results.WaferResultList(1).elt.ImageResultList.elt.ExposureResultList(1).elt.SbcResiduals.Corrections);\r","number_of_exposures = numel(xml_data.Results.WaferResultList(1).elt.ImageResultList.elt.ExposureResultList);\r","\r","% build the base ml structure\r","ml.wd.xf = ml_cet.wd.xf;\r","ml.wd.yf = ml_cet.wd.yf;\r","ml.wd.xc = round(reshape(repmat(xc, full_grid_size,1), [], 1), ROUNDING_SF);\r","ml.wd.yc = round(reshape(repmat(yc, full_grid_size,1), [], 1), ROUNDING_SF);\r","ml.wd.xw = ml.wd.xf + ml.wd.xc;\r","ml.wd.yw = ml.wd.yf + ml.wd.yc;\r","\r","%make sure xw, yw are same\r","if ~isequal(ml.wd.xw, ml_cet.wd.xw) || ~isequal(ml.wd.yw, ml_cet.wd.yw)\r","    error('Error parsing: ADELexposeTrajectoriesReport and ADELwaferGridResidualReport have different wafer coordinates (xw,yw)');\r","end\r","ml.nmark = full_grid_size;\r","ml.nfield = number_of_exposures;\r","ml.nlayer = 1;\r","ml.nwafer = numel(xml_data.Results.WaferResultList);\r","\r","wr.dx = [];\r","wr.dy = [];\r","ml.layer.wr = repmat(wr, 1, ml.nwafer);\r","\r","% copy the base ml struct for KA correction & residual\r","ml_KA_cet_corr = ml;\r","ml_KA_cet_corr.tlgname = 'KA CET corrections';\r","\r","ml_KA_cet_nce  = ml;\r","ml_KA_cet_nce.tlgname = 'KA CET residuals';\r","\r","\r","for iw = 1:ml.nwafer\r","    for i_exp = 1:number_of_exposures\r","        % map the residuals and corrections of each field to ml struct\r","        corr_dx_field = str2double(arrayfun(@(x) (x.elt.Dx), xml_data.Results.WaferResultList(iw).elt.ImageResultList(1).elt.ExposureResultList(i_exp).elt.SbcResiduals.Corrections, 'UniformOutput', false)) * 1e-9;\r","        corr_dy_field = str2double(arrayfun(@(x) (x.elt.Dy), xml_data.Results.WaferResultList(iw).elt.ImageResultList(1).elt.ExposureResultList(i_exp).elt.SbcResiduals.Corrections, 'UniformOutput', false)) * 1e-9;\r","        nce_dx_field  = str2double(arrayfun(@(x) (x.elt.Dx), xml_data.Results.WaferResultList(iw).elt.ImageResultList(1).elt.ExposureResultList(i_exp).elt.SbcResiduals.Residuals, 'UniformOutput', false)) * 1e-9;\r","        nce_dy_field  = str2double(arrayfun(@(x) (x.elt.Dy), xml_data.Results.WaferResultList(iw).elt.ImageResultList(1).elt.ExposureResultList(i_exp).elt.SbcResiduals.Residuals, 'UniformOutput', false)) * 1e-9;\r","        \r","        ml_KA_cet_corr.layer.wr(iw).dx  = [ml_KA_cet_corr.layer.wr(iw).dx ; corr_dx_field(:)];\r","        ml_KA_cet_corr.layer.wr(iw).dy  = [ml_KA_cet_corr.layer.wr(iw).dy ; corr_dy_field(:)];\r","        \r","        ml_KA_cet_nce.layer.wr(iw).dx   = [ml_KA_cet_nce.layer.wr(iw).dx ; nce_dx_field(:)];\r","        ml_KA_cet_nce.layer.wr(iw).dy   = [ml_KA_cet_nce.layer.wr(iw).dy ; nce_dy_field(:)];\r","    end\r","end\r","\r","\r","if isfield(xml_data.Results, 'ReportedSbcResiduals')\r","    if strcmp(xml_data.Results.ReportedSbcResiduals, 'Higher Order KA Actuation')\r","        KA_actuation = 'HOC';\r","    elseif  strcmp(xml_data.Results.ReportedSbcResiduals, 'Lower Order KA Actuation')\r","        KA_actuation = 'LOC';\r","    else\r","        KA_actuation = [];\r","    end\r","else\r","    KA_actuation = [];\r","end\r","\r","\r","\r",""],"CoverageData":{"CoveredLineNumbers":[],"UnhitLineNumbers":[17,19,22,23,25,26,29,30,31,32,33,34,37,38,40,41,42,43,45,46,47,50,51,53,54,57,58,60,61,62,63,65,66,68,69,74,75,76,77,78,79,80,82,83],"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}