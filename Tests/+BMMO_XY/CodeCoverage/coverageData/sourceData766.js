var sourceData766 = {"FileContents":["% Changelog\r","% 2016-09-26  SBPR  creation\r","% 2018-12-20  SELR  fixed GenerateWH\r","% 2019-03-08  SELR  added SUSD content, fix for 1L case\r","% 2020-05-20  SELR  refactoring\r","\r","\r","function [ml_r, ml_comp] = bmmo_simulate_random_input(input_struct, name_SBC, noise3s)\r","\r","[mli, options] = bmmo_process_input(input_struct);\r","\r","mlo = SumSBCs_input(name_SBC, mli, options);\r","mlo_noise = ovl_fill_noise(mlo, 'nwafer', mlo.nwafer, 'noise_level', noise3s/3*1e-9);\r","ml_input = ovl_add(mlo, mlo_noise);\r","\r","ml_r = bmmo_map_to_smf(ml_input, input_struct);\r","ml_comp = mlo.comp;\r","\r","\r","function mlo = SumSBCs_input(name_SBC, template_mli, options)\r","\r","if (length(name_SBC)>6)\r","    error('More than 6 SBCs cannot be used');\r","end\r","mlo = ovl_combine_linear(template_mli,0);\r","mlo_B = mlo;\r","mlo_I = mlo;\r","mlo_M = mlo;\r","mlo_K = mlo;\r","mlo_W = mlo;\r","mlo_S = mlo;\r","count = 0;\r","if ismember('B',name_SBC)\r","    [res, BAO_par] = ovl_model(template_mli,'perwafer');\r","    fp_name = fieldnames(BAO_par.wafer);\r","    bao_rand{1} = randn(1,length(fp_name)-1);\r","    bao_rand{2} = randn(1,length(fp_name)-1);\r","    for iw=1:6\r","        for ifield = 1:length(fp_name)-1\r","            if ismember(fp_name{ifield}, {'tx','ty'})\r","                scale = 1e-9;\r","            else\r","                scale = 1e-8;\r","            end\r","            BAO_par.wafer(iw).(fp_name{ifield}) = bao_rand{2-mod(iw,2)}(ifield)*scale;\r","        end\r","    end\r","\r","    mlo_B = GenerateBAO(template_mli, BAO_par);\r","    mlo = ovl_add(mlo, mlo_B);\r","    count = count+1;\r","end\r","if ismember('I', name_SBC)\r","    mlo_I = bmmo_generate_INTRAF(template_mli, options);\r","    mlo_I = scale2one(mlo_I);\r","    mlo = ovl_add(mlo, mlo_I);\r","    count = count+1;\r","end\r","if ismember('M', name_SBC)\r","    mlo_M = bmmo_generate_MI(template_mli, options);\r","    mlo_M = scale2one(mlo_M);\r","    mlo = ovl_add(mlo, mlo_M);\r","    count = count+1;\r","end\r","if ismember('W', name_SBC)\r","    WH_rand =randn(1,1);\r","    mlo_W = GenerateWH(template_mli, WH_rand, options);\r","    mlo = ovl_add(mlo, mlo_W);\r","    count = count+1;\r","end\r","if ismember('S', name_SBC)\r","    SUSD_rand = 1e-9*randn(1,1);\r","    mlo_S = GenerateSUSD(template_mli, SUSD_rand, options);\r","    mlo = ovl_add(mlo, mlo_S);\r","    count = count+1;\r","end\r","if ismember('K', name_SBC)\r","    if options.bl3_model\r","        mlo_K = bl3_generate_KA(template_mli, options);\r","    else\r","        mlo_K = bmmo_generate_KA(template_mli, options);\r","    end\r","    mlo_K = scale2one(mlo_K);\r","    mlo = ovl_add(mlo, mlo_K);\r","    count = count + 1;\r","end\r","mlo.comp.BAO    = mlo_B;\r","mlo.comp.INTRAF = mlo_I;\r","mlo.comp.MI     = mlo_M;\r","mlo.comp.WH     = mlo_W;\r","mlo.comp.SUSD   = mlo_S;\r","mlo.comp.KA     = mlo_K;\r","mlo.comp.TOTAL  = mlo;\r","\r","if ~(count==length(name_SBC))\r","    error('# of SBC component in the input doesn''t match with the input generation.');\r","end\r","\r","\r","function mlo = GenerateBAO(template_mli, BAO_par)\r","\r","mlz = ovl_combine_linear(template_mli, 0 );\r","mlo = ovl_model(mlz, 'apply', BAO_par,'perwafer');\r","\r","mlo = scale2one(mlo);\r","\r","\r","function mlo = GenerateSUSD(template_mli, SUSD_par, options)\r","\r","mli = ovl_combine_linear(template_mli, 0);\r","\r","mlo = bmmo_SUSD_fingerprint(mli, options.Scan_direction, SUSD_par);\r","\r","\r","function mlo = GenerateWH(template_mli, WH_par, options)\r","\r","WH_par_tmp = WH_par*options.IR2EUVsensitivity;\r","options2=options;\r","options2.previous_correction.IR2EUV = WH_par_tmp;\r","mlo = bmmo_WH_SBC_fingerprint(template_mli, options2);\r","mlo = ovl_remove_edge(mlo, options.edge_clearance);\r","mlo = ovl_combine_linear(template_mli, 0, mlo, 1);\r","mlo_s2f = mlo;\r","mlo_s2f_scaled = scale2one(mlo_s2f);\r","[coeff,res,fps_fit] = ovl_fit_fingerprints(mlo_s2f_scaled,mlo_s2f);\r","\r","mlo = ovl_combine_linear(mlo, coeff);\r","mlo.ir2euv = WH_par_tmp*coeff;\r","\r","\r","function mlo = scale2one(mli)\r","\r","mlo=mli;\r","for iw=1:mli.nwafer\r","    mlo.layer.wr(iw).dx = mli.layer.wr(iw).dx *(1/max(abs(mli.layer.wr(iw).dx)))*1e-9;\r","    mlo.layer.wr(iw).dy = mli.layer.wr(iw).dy *(1/max(abs(mli.layer.wr(iw).dy)))*1e-9;\r","end\r",""],"CoverageData":{"CoveredLineNumbers":[10,12,13,14,16,17,22,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,45,49,50,51,53,54,55,56,57,59,60,61,62,63,65,66,67,68,69,71,72,73,74,75,77,78,80,81,83,84,85,87,88,89,90,91,92,93,95,102,103,105,110,112,117,118,119,120,121,122,123,124,125,127,128,133,134,135,136],"UnhitLineNumbers":[23,79,96],"HitCount":[0,0,0,0,0,0,0,0,0,1,0,1,1,1,0,1,1,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,60,12,48,48,0,60,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1,1,0,1,1,1,0,1,1,1,1,1,1,1,0,1,0,0,0,0,0,0,1,1,0,1,0,0,0,0,1,0,1,0,0,0,0,1,1,1,1,1,1,1,1,1,0,1,1,0,0,0,0,5,5,30,30,0,0]}}