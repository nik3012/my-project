var sourceData104 = {"FileContents":["function wdm = bmmo_generate_WDM(model_results, options)\r","% function wdm = bmmo_generate_WDM(model_results, options)\r","%\r","% Process the results of BMMO-NXE and BL3 modelling for the creation of \r","% waferdatamaps\r","%\r","% Input:\r","%   model_results: structure containing results of modelling and\r","%                  delta_filtered\r","%                  delta_unfiltered\r","%                  total_filtered\r","%                  total_unfiltered\r","%   options: BMMO/BL3 options structure\r","%\r","% Output:\r","%   wdm: Waferdatamaps as defined in  EDS D000810611\r","\r","wdm.controlled_meas_per_wafer = model_results.ml_outlier_removed;\r","wdm.controlled_meas = bmmo_average_chuck(model_results.ml_outlier_removed, options);\r","wdm.uncontrolled_meas_per_wafer = model_results.uncontrolled;\r","wdm.uncontrolled_meas = bmmo_average_chuck(model_results.uncontrolled, options);\r","wdm.model_residual = bmmo_average_chuck(model_results.res, options);\r","wdm.previous_actuated_inlineSDM = bmmo_average_chuck(model_results.previous_actuated_inlineSDM, options);\r","\r","if isfield(model_results.delta_unfiltered, options.intraf_nce_modelresult.name)\r","    model_results.delta_unfiltered = rmfield(model_results.delta_unfiltered, options.intraf_nce_modelresult.name);\r","end\r","\r","correctiondata = {'total_filtered', 'total_unfiltered', 'delta_unfiltered'};\r","corrset = {'SUSD', 'KA', 'MI', 'BAO', 'TotalSBCcorrection'};\r","\r","for corrdat_i = 1:length(correctiondata)\r","    wdm.(correctiondata{corrdat_i}) = model_results.(correctiondata{corrdat_i});\r","    \r","    % remove 18/33 par INTRAF as it will be generated by analytics\r","    wdm.(correctiondata{corrdat_i}) = rmfield(wdm.(correctiondata{corrdat_i}), 'INTRAF');\r","    \r","    % wafer average for WH correction, if 2L get 89 fields\r","    % using bmmo_average_chuck before averaging all wafers since\r","    % ovl_average gives incorrect values for odd wafers\r","    wdm_tmp1 = (wdm.(correctiondata{corrdat_i}).WH);\r","    wdm_tmp1 = bmmo_average_chuck(wdm_tmp1, options);\r","    wdm_tmp = ovl_average(wdm_tmp1(1),wdm_tmp1(2),'overall');\r","\r","    wdm.(correctiondata{corrdat_i}).WH = sub_select_89_fields(wdm_tmp, options);\r","    \r","    % chuck average the rest of the non-chuck avg corrections\r","    for corrset_i = 1:length(corrset)\r","        wdm_tmp = wdm.(correctiondata{corrdat_i}).(corrset{corrset_i});\r","        wdm_tmp = bmmo_average_chuck(wdm_tmp, options);\r","        \r","        % if these wdms are in 2L get 89 fields\r","        for ichk = 1:length(wdm_tmp)\r","            wdm.(correctiondata{corrdat_i}).(corrset{corrset_i})(ichk) =  sub_select_89_fields(wdm_tmp(ichk), options);\r","        end\r","    end\r","end\r","\r","% if the rest of the wdms are in 2L get 89 fields\r","other = {'uncontrolled_meas', 'controlled_meas', 'model_residual', 'controlled_meas_per_wafer', 'uncontrolled_meas_per_wafer'};\r","for irest = 1:length(other)\r","    for ichk = 1:length(wdm.(other{irest}))\r","        wdm.(other{irest})(ichk) = sub_select_89_fields(wdm.(other{irest})(ichk), options);\r","    end\r","end\r","\r","\r","function wdm_1L_f = sub_select_89_fields(wdm_in, options)\r","  if wdm_in.nfield > 89\r","     wdm_1L_f = ovl_get_fields(wdm_in, [options.layer_fields{1}, options.edge_fields]);\r","  else\r","     wdm_1L_f = wdm_in;\r","  end"],"CoverageData":{"CoveredLineNumbers":[],"UnhitLineNumbers":[18,19,20,21,22,23,25,26,29,30,32,33,36,41,42,43,45,48,49,50,53,54,60,61,62,63,69,70,71,72],"HitCount":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}